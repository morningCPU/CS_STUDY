# 第二章 高级数据模型

主要介绍 ERM
+ ERM(Entity-Relationship Model):实体联系模型
用于描述信息世界的概念数据模型。通过画图将实体以及实体间的联系刻画出来，为客观事物建立概念数据模型

***

## 一、数据库的设计过程
1.**需求分析** 
其中有数据流图(DFD),现实系统描述
2.**概念数据库设计** 
其中有ER图,视图抽象，概念抽象
3.**逻辑数据库设计**
物理抽象
4.**模式优化**
物理抽象
5.**物理数据库设计**
6.**安全性设计**
+ 数据库的概念模型独立于具体的机器和DBMS

***
## 二、数据结构描述
### (1)对实体描述

ER图用实体型(注意不是实体)和属性来描述实体
用**矩形**表示实体

1.**相关概念**

+ **实体(entity)**
现实世界中或客观世界中有别于其它对象的对象
+ **实体型(entity set)**
属于同类的所有实体的集合，一般会简称为实体
ER图中所说的实体一般就是实体型
+ **属性(attribute)**
实体的特征或性质。实体用属性描述。
用**椭圆**表示属性
+ **键(key)**
具有唯一标识特性的一个或一组属性，用于唯一标识一类实体集中的实体

2.**属性的分类**

+ **按结构分**
简单属性，复合属性(**椭圆连接椭圆**)
+ **按取值分**
单值属性，多值属性(**双椭圆**)，导出属性(**虚线椭圆**)，空值属性

3.**键的分类**
按组成键的属性多少有简单键和复合键
+ 超键
能唯一标识实体的属性集(只要里面有候选键就行，不管有多少属性)
+ 候选键
能唯一标识实体的最小属性集
+ 主键
选定的一个候选键
下方标一条横线
+ 全键
包含所有属性的候选键
+ 外键

4.**实体的ER图表示方法**

<!-- ![实体](images/实体.jpg "实体") -->

5.**例题**
学生（学号，姓名，性别，身份证号，年龄）
<!-- ![实体例题](images/实体例题.jpg "实体例题") -->

### (2)对实体间联系的描述
ER模型用联系型和属性来描述实体间联系

1.**相关概念**
+ **联系(relationship)**
两个或多个实体间的关联
+ **联系型(relationship set)**
同类的一组联系,一般简称为联系
+ **联系的描述属性(description attribute)**
记录联系的信息
+ **联系的标识**
联系的主键由参与实体的主键与练习的部分属性来确定
+ **联系的阶**
一个联系所关联的实体的数量
二元联系，三元联系，n元联系
联系用菱形表示

<!-- ![联系](images/联系.jpg "联系") -->

2.**例题**
设某商业集团数据库中有三个实体集。
一是“商店”实体集，属性有商店编号、商店名、地址等；
二是“商品”实体集，属性有商品号、商品名、规格、单价等；
三是“职工”实体集，属性有职工编号、姓名、性别、业绩等。
商店与商品间存在“销售”联系，每个商店可销售多种商品，每种商品也可放在多个商店销售，每个商店销售每一种商品，有月销售量；商店与职工间存在着“聘用”联系，每个商店有许多职工，每个职工只能在一个商店工作，商店聘用职工有聘期和月薪。
<!-- ![联系例题](images/联系例题.jpg "联系例题") -->

***

# 三、数据约束描述

## (1)一般性约束和键约束

### 1.键约束
+ 联系分类：
一对一约束(1:1)
一对多约束(1:n)
多对多约束(m:n)

### 2.键约束
如果在一个联系的实例中，它所关联的实体最多只能出现在一个联系实例中，它就可以唯一确定该联系
+ 1:1 或 1:n 约束，并且关系没有属性就要画上键约束
+ 表明给定一个实体，即可唯一确定期间的联系

## (2)参与约束与弱实体约束

### 1.参与约束
实体与联系之间的约束，即实体型中实体如何参与到联系中
+ 实体参与联系的最小和最大次数
+ 完全参与约束：实体集中每个实体都参与到联系集中的至少一个联系
+ 部分参与约束：实体集中只有部分实体参与到联系中

### 2.弱实体约束
没有键属性的实体型称为弱实体型
+ 弱实体：依赖于其他实体而存在的实体
+ 识别实体与弱实体必须参与的是1:n联系，该联系即为该弱实体的识别联系
+ 弱实体型必须完全参与识别联系
+ 部分键：弱实体型必须具有一个或多个属性，使得这些属性可以与识别实体型的键结合形成相应弱实体型的键。这样的弱实体属性称为弱实体型的部分键

### 3.排除约束

***

# 五、扩展实体联系模型

## 1.类层次(ISA)
最上层称为超类，下层为子类
+ 联系用三角形表示

## 2.聚集
将联系以及该联系所关联的实体一起，作为一个高层实体(或虚实体)来对待，该高层实体集为聚集

***

# 六、利用ERM进行概念数据库设计

## 1.需要考虑的问题
(1)一个概念时实体还是实体的属性
(2)一个概念时实体的属性还是联系的属性
(3)使用二元联系，三元联系，还是多元联系
(4)是否有弱实体需要考虑

## 2.实体与属性的取舍
+ 复合属性和多值属性的处理
用实体：
需要表达其结构或做细分查询
需要记录多个值

## 3.多值属性的处理
+ 增加几个新的属性
+ 增加一个新的实体，弱实体

## 4.属性在实体与联系之间的取舍

## 5.二元联系与三元联系的取舍

## 6.ER模型存在的问题
+ 连接陷阱
扇形陷阱：当一个实体与其他实体之间存在两个或多个一对多联系时可能存在扇形陷阱
深坑陷阱：实体之间存在联系，但某些实体之间却不存在相应的通路